# coding=utf-8
"""
==========================================================
第一课：基础环境设置与认证
==========================================================

学习目标：
1. 理解掘金量化SDK的基本结构
2. 学会设置Token进行身份认证
3. 了解两种使用模式：数据提取模式 vs 策略运行模式

前置条件：
- 安装掘金终端并注册账号
- 获取Token（终端 -> 系统设置 -> 密钥管理）
- pip install gm  (安装SDK)
"""

from __future__ import print_function, absolute_import

# ==========================================================
# 第一步：导入SDK
# ==========================================================
# gm.api 包含了所有常用的函数和常量
# 使用 * 导入可以直接使用所有API，无需前缀
from gm.api import *

# 也可以选择性导入特定函数（推荐在大型项目中使用）
# from gm.api import set_token, history, current, subscribe

# ==========================================================
# 第二步：设置Token（身份认证）
# ==========================================================
# Token是你的身份标识，用于访问掘金服务器
# 获取方式：掘金终端 -> 系统设置 -> 密钥管理

# 重要提示：请将下面的token替换为你自己的token
YOUR_TOKEN = "your_token_here"  # 替换为真实token

# set_token() 必须在调用任何数据函数之前执行
# 如果token无效，后续的API调用会抛出异常
set_token(YOUR_TOKEN)

print("Token设置完成！")

# ==========================================================
# 第三步：验证连接 - 获取当前行情快照
# ==========================================================
# current() 函数获取指定股票的当前行情快照
# 参数 symbols: 股票代码，格式为 "交易所.代码"
#   - SHSE = 上海证券交易所 (Shanghai Stock Exchange)
#   - SZSE = 深圳证券交易所 (Shenzhen Stock Exchange)

try:
    # 获取浦发银行(600000)的当前行情
    ticks = current(symbols="SHSE.600000")

    if ticks:
        print("\n连接成功！获取到行情数据：")
        print("-" * 50)
        tick = ticks[0]
        print(f"股票代码: {tick.get('symbol')}")
        print(f"最新价格: {tick.get('price')}")
        print(f"开盘价: {tick.get('open')}")
        print(f"最高价: {tick.get('high')}")
        print(f"最低价: {tick.get('low')}")
        print(f"成交量: {tick.get('cum_volume')}")
        print(f"成交额: {tick.get('cum_amount')}")
    else:
        print("未获取到数据，请检查市场是否开盘")

except Exception as e:
    print(f"连接失败: {e}")
    print("请检查：")
    print("1. Token是否正确")
    print("2. 掘金终端是否已启动")
    print("3. 网络连接是否正常")

# ==========================================================
# 第四步：理解股票代码格式
# ==========================================================
print("\n" + "=" * 50)
print("股票代码格式说明")
print("=" * 50)

# 股票代码统一格式: 交易所.代码
CODE_EXAMPLES = """
交易所代码：
  SHSE  - 上海证券交易所 (上交所)
  SZSE  - 深圳证券交易所 (深交所)
  SHFE  - 上海期货交易所
  DCE   - 大连商品交易所
  CZCE  - 郑州商品交易所
  CFFEX - 中国金融期货交易所
  INE   - 上海国际能源交易中心

示例：
  SHSE.600000  - 浦发银行（上交所股票）
  SZSE.000001  - 平安银行（深交所股票）
  SHSE.000001  - 上证指数（指数）
  SHFE.rb2401  - 螺纹钢期货2401合约
  SHSE.510050  - 50ETF（基金）
  SHSE.10004645 - 50ETF期权
"""
print(CODE_EXAMPLES)

# ==========================================================
# 第五步：理解SDK的两种使用模式
# ==========================================================
print("\n" + "=" * 50)
print("SDK的两种使用模式")
print("=" * 50)

MODES_INFO = """
模式一：数据提取模式（本例使用的模式）
-----------------------------------------
特点：
  - 只需要 set_token() 即可
  - 不需要调用 run() 函数
  - 适合数据研究、分析、回测前的数据准备
  - 可以在Jupyter Notebook中使用

使用场景：
  - 下载历史数据
  - 数据分析和可视化
  - 因子研究
  - 策略开发前的数据探索

模式二：策略运行模式（后续课程介绍）
-----------------------------------------
特点：
  - 需要调用 run() 函数启动策略
  - 支持实时行情订阅
  - 支持自动交易
  - 事件驱动架构

使用场景：
  - 回测策略
  - 模拟交易
  - 实盘交易
"""
print(MODES_INFO)

# ==========================================================
# 练习题
# ==========================================================
print("\n" + "=" * 50)
print("练习题")
print("=" * 50)

EXERCISES = """
1. 修改代码，获取平安银行(SZSE.000001)的当前行情
2. 尝试获取多只股票的行情：current(symbols='SHSE.600000,SZSE.000001')
3. 打印tick数据中的所有字段，了解有哪些可用信息

提示：使用 print(tick.keys()) 查看所有可用字段
"""
print(EXERCISES)

# ==========================================================
# 知识点总结
# ==========================================================
print("\n" + "=" * 50)
print("本课知识点总结")
print("=" * 50)

SUMMARY = """
1. from gm.api import * - 导入SDK所有函数和常量
2. set_token(token) - 设置身份认证token
3. current(symbols) - 获取当前行情快照
4. 股票代码格式: 交易所.代码 (如 SHSE.600000)
5. 两种模式: 数据提取模式(无需run) / 策略运行模式(需要run)

下一课预告：历史数据查询 - history() 函数详解
"""
print(SUMMARY)
